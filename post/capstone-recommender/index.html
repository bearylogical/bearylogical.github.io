<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.7.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Syamil Maulod">

  
  
  
    
  
  <meta name="description" content="Doc2Vec in the Wild">

  
  <link rel="alternate" hreflang="en-us" href="/post/capstone-recommender/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu914c65fc3408b2ad669c7753418c6144_392_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu914c65fc3408b2ad669c7753418c6144_392_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/capstone-recommender/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Syamil Maulod">
  <meta property="og:url" content="/post/capstone-recommender/">
  <meta property="og:title" content="Capstone #3 Content Discovery System | Syamil Maulod">
  <meta property="og:description" content="Doc2Vec in the Wild"><meta property="og:image" content="/post/capstone-recommender/featured.png">
  <meta property="twitter:image" content="/post/capstone-recommender/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-07-31T15:57:29&#43;08:00">
    
    <meta property="article:modified_time" content="2019-07-31T15:57:29&#43;08:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/capstone-recommender/"
  },
  "headline": "Capstone #3 Content Discovery System",
  
  "image": [
    "/post/capstone-recommender/featured.png"
  ],
  
  "datePublished": "2019-07-31T15:57:29+08:00",
  "dateModified": "2019-07-31T15:57:29+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Syamil Maulod"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Syamil Maulod",
    "logo": {
      "@type": "ImageObject",
      "url": "img//"
    }
  },
  "description": "Doc2Vec in the Wild"
}
</script>

  

  


  


  





  <title>Capstone #3 Content Discovery System | Syamil Maulod</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Syamil Maulod</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Syamil Maulod</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/tutorial/"><span>Tutorials</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Capstone #3 Content Discovery System</h1>

  
  <p class="page-subtitle">Post #3 on FastParliament</p>
  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Jul 31, 2019
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    9 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/data-science/">data-science</a></span>
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 252px;">
  <div style="position: relative">
    <img src="/post/capstone-recommender/featured_hu5c0e7e3406fdb67302580d0358b282d7_109625_720x0_resize_lanczos_2.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      

<blockquote>
<p>This is the third of a multi part series that details the processes behind <a href="https://fparl.bearylogical.net">FastParliament</a>. You may view the previous post <a href="/post/capstone-summarizer/">here</a>:</p>
</blockquote>

<p><h2>Table of Contents</h2>
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#recap-of-vector-representations">Recap of Vector Representations</a></li>
<li><a href="#enter-word2vec">Enter Word2Vec</a></li>
<li><a href="#doc2vec-an-extension-of-word2vec">Doc2Vec : An Extension of Word2Vec</a></li>
<li><a href="#applying-doc2vec-for-fastparliament">Applying Doc2Vec for FastParliament</a></li>
<li><a href="#walkthrough-of-doc2vec-process">Walkthrough of Doc2Vec Process</a></li>
<li><a href="#1-import-libraries">1. Import Libraries</a></li>
<li><a href="#2-read-in-data-from-mongodb">2. Read in Data from MongoDB</a></li>
<li><a href="#3-text-preprocessing">3. Text Preprocessing</a></li>
<li><a href="#4-instantiating-a-doc2vec-gensim-instance">4. Instantiating a Doc2Vec GenSim Instance</a></li>
<li><a href="#5-build-a-vocabulary">5. Build a Vocabulary</a>
<ul>
<li><a href="#6-save-model">6. Save Model</a></li>
</ul></li>
<li><a href="#7-load-model">7. Load Model</a></li>
<li><a href="#8-sample-inference">8. Sample Inference</a></li>
<li><a href="#9-using-it-in-production">9. Using it in Production</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</nav></p>

<p>For this post, I will be focusing on the content discovery component of <a href="https://fparl.bearylogical.net/#summary">FastParliament</a>.</p>

<p>If you have been around FastParliament, you may have observed that each time an article is retrieved from the system, a series of articles are also put forth - which are related to the content of the primary article. Usually, to do so in conventional systems would require the use of &ldquo;tags&rdquo; that article has to allow the system to &ldquo;cough&rdquo; out articles with similar tags.</p>






  
  











<figure>


  <a data-fancybox="" href="/post/capstone-recommender/recommender_hu8e3f2182230b05f4e85ddab698b6aa12_188796_2000x2000_fit_lanczos_2.png" data-caption="Content Discovery">


  <img data-src="/post/capstone-recommender/recommender_hu8e3f2182230b05f4e85ddab698b6aa12_188796_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="1256" height="735">
</a>


  
  
  <figcaption>
    Content Discovery
  </figcaption>


</figure>


<p>This works well for a small corpus of say, 50 to at most 200 articles. However, the solution obviously does not scale very well, if not at all. Furthermore, the tagging system can be highly arbitrary, where each person can have their own interpretation of what tags are contained in a particular article.</p>

<h2 id="recap-of-vector-representations">Recap of Vector Representations</h2>

<p>In the <a href="/post/capstone-summarizer/">previous</a> article, sentence vectors were created out of the TF-IDF method where the vector represented weighted frequencies of a particular word in a text.</p>

<p>While that works for the particular use case, semantics are often lost when we are merely looking at counts of a particular word in the document.</p>

<h2 id="enter-word2vec">Enter Word2Vec</h2>

<blockquote>
<p>Most portions of this description are based on the writeup by <a href="https://medium.com/scaleabout/a-gentle-introduction-to-doc2vec-db3e8c0cce5e">Gidi Shperber</a> in which he has a good summary on Doc2Vec.</p>
</blockquote>

<p>Word2Vec is a technique to capture contexts between words. There are two key models in word2vec - namely Continuous Bag of Words(CBoW) and Skip-Gram. For CBoW a sliding window is created around a bunch of words or context with the objective of predicting the probability of the target word. In Skip-Gram, the opposite occurs in which we want to predict the context (&ldquo;surrounding words&rdquo;) given a specific word.</p>

<p>Depending on the case use, one particular model may be preferred over another.</p>






  
  











<figure>


  <a data-fancybox="" href="/post/capstone-recommender/word2vec_hu77da82a9bad4a5fb714f538ac9e021ef_121775_2000x2000_fit_lanczos_2.png" data-caption="Word2Vec Methods Illustration Obtained from Rakuten">


  <img data-src="/post/capstone-recommender/word2vec_hu77da82a9bad4a5fb714f538ac9e021ef_121775_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="626" height="468">
</a>


  
  
  <figcaption>
    Word2Vec Methods Illustration Obtained from <a href="https://www.slideshare.net/rakutentech/distributed-representationbased-recommender-systems-in-ecommerce">Rakuten</a>
  </figcaption>


</figure>


<p>The end result, or representations would be somewhat visualised as below:</p>
















<figure>


  <a data-fancybox="" href="https://www.tensorflow.org/images/linear-relationships.png" data-caption="Semantic Representation from word vectors. Obtained from tensorflow docs.">


  <img src="https://www.tensorflow.org/images/linear-relationships.png" alt=""  >
</a>


  
  
  <figcaption>
    Semantic Representation from word vectors. Obtained from <a href="https://www.tensorflow.org/tutorials/representation/word2vec">tensorflow docs</a>.
  </figcaption>


</figure>


<p>So, then where does that leave us?</p>

<p>Knowing that there is a way to represent text as vector representations that is context-aware would mean that we can apply the same concept to our Hansard corpus.</p>

<p>This would require converting each document to its vector representation in relation to the entire corpus.</p>

<h2 id="doc2vec-an-extension-of-word2vec">Doc2Vec : An Extension of Word2Vec</h2>

<p>One key consideration between the Doc2Vec and Word2Vec is that documents and words don&rsquo;t share the same logical structures. The continuous representation that we see in a line of text may not be the same as a line of documents.</p>

<p>To get around this problem, an additional vector is fed into either the Doc2Vec version of either the CBoW or the Skip-Gram method. This additional vector is referred to as the document vector which is essentially the &ldquo;ID&rdquo; of the document.</p>






  
  











<figure>


  <a data-fancybox="" href="/post/capstone-recommender/doc2vec_hua699b4048c861c4a5b8c1eb5814ea50a_144611_2000x2000_fit_lanczos_2.png" data-caption="Doc2Vec Methods Illustration Obtained from Rakuten">


  <img data-src="/post/capstone-recommender/doc2vec_hua699b4048c861c4a5b8c1eb5814ea50a_144611_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="620" height="470">
</a>


  
  
  <figcaption>
    Doc2Vec Methods Illustration Obtained from <a href="https://www.slideshare.net/rakutentech/distributed-representationbased-recommender-systems-in-ecommerce">Rakuten</a>
  </figcaption>


</figure>


<p>In this case the CBoW now becomes Document Vector Distributed Bag of Words (DV-DBoW) while the Skip-Gram approach is now called Document Vector Distributed Memory (DV-DM) in which the document vector acts as a &ldquo;memory&rdquo; to assist in identifying the context of the particular word in a document. Essentially, it extends the concept of a particular word beyond the sliding window to between various documents.</p>

<h2 id="applying-doc2vec-for-fastparliament">Applying Doc2Vec for FastParliament</h2>

<p>Now, with these concepts in hand, we look at applying the same approaches to our corpus with the objective of generating document to document recommendations to aid in content discovery.</p>

<h2 id="walkthrough-of-doc2vec-process">Walkthrough of Doc2Vec Process</h2>

<p>In this example, I will be using gensim&rsquo;s doc2vec generator to generate the vectors. I will also extend this further by showing how I operationalized this on FastParliament.</p>

<h2 id="1-import-libraries">1. Import Libraries</h2>

<pre><code class="language-python">import gensim
from gensim.utils import simple_preprocess
import pymongo
import pandas as pd
import numpy as np

from bson import ObjectId
from sklearn.model_selection import train_test_split
</code></pre>

<h2 id="2-read-in-data-from-mongodb">2. Read in Data from MongoDB</h2>

<pre><code class="language-python">client = pymongo.MongoClient(&quot;mongodb://localhost:27017/&quot;)

db = client[&quot;parliament&quot;]
articles = db[&quot;articles&quot;]
</code></pre>

<pre><code class="language-python">mongo_df = pd.DataFrame.from_records(remote_articles.find())
mongo_df.head()
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_id</th>
      <th>article_text</th>
      <th>chunks</th>
      <th>cleaned_join</th>
      <th>dominant_topic</th>
      <th>html_clean</th>
      <th>parliament_num</th>
      <th>parsed_convo</th>
      <th>persons_involved</th>
      <th>session_num</th>
      <th>session_type</th>
      <th>sitting_date</th>
      <th>sitting_num</th>
      <th>src_url</th>
      <th>title</th>
      <th>volume_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5d27eca6172d9aa762d4802f</td>
      <td>&lt;p&gt;[(proc text) Debate resumed. (proc text)]&lt;/...</td>
      <td>{"0": {"entity": "NA", "content": "[(proc text...</td>
      <td>[(proc text) Debate resumed. (proc text)]&lt;br/&gt;...</td>
      <td>Society</td>
      <td>[[(proc text) Debate resumed. (proc text)], Mr...</td>
      <td>13</td>
      <td>[{'content': '[(proc text) Debate resumed. (pr...</td>
      <td>[Mr Leon Perera, Mr K Shanmugam, Assoc Prof Wa...</td>
      <td>2</td>
      <td>SECOND READING BILLS</td>
      <td>2019-05-08</td>
      <td>105</td>
      <td>https://sprs.parl.gov.sg/search/sprs3topic?rep...</td>
      <td>PROTECTION FROM ONLINE FALSEHOODS AND MANIPULA...</td>
      <td>94</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5d27eca6172d9aa762d48030</td>
      <td>&lt;p class="ql-align-justify"&gt;4 &lt;strong&gt;Mr Vikra...</td>
      <td>{"0": {"entity": "NA", "content": "Mr Vikram N...</td>
      <td>Mr Vikram Nair asked the Minister for Foreign ...</td>
      <td>Society</td>
      <td>[Mr Vikram Nair asked the Minister for Foreign...</td>
      <td>13</td>
      <td>[{'content': 'Mr Vikram Nair asked the Ministe...</td>
      <td>[Dr Vivian Balakrishnan, The Minister for Fore...</td>
      <td>2</td>
      <td>ORAL ANSWERS</td>
      <td>2019-05-08</td>
      <td>105</td>
      <td>https://sprs.parl.gov.sg/search/sprs3topic?rep...</td>
      <td>STATE OF BILATERAL RELATIONS WITH MALAYSIA FOL...</td>
      <td>94</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5d27eca6172d9aa762d48031</td>
      <td>&lt;p class="ql-align-justify"&gt;8 &lt;strong&gt;Assoc Pr...</td>
      <td>{"0": {"entity": "NA", "content": "Assoc Prof ...</td>
      <td>Assoc Prof Walter Theseira asked the Minister ...</td>
      <td>Internal Security</td>
      <td>[Assoc Prof Walter Theseira asked the Minister...</td>
      <td>13</td>
      <td>[{'content': 'Assoc Prof Walter Theseira asked...</td>
      <td>[Ms Low Yen Ling, Ms Anthea Ong, Assoc Prof Wa...</td>
      <td>2</td>
      <td>ORAL ANSWERS</td>
      <td>2019-05-08</td>
      <td>105</td>
      <td>https://sprs.parl.gov.sg/search/sprs3topic?rep...</td>
      <td>COMPANIES WITH MEASURES TO DEAL WITH WORKPLACE...</td>
      <td>94</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5d27eca6172d9aa762d48032</td>
      <td>&lt;p&gt;5 &lt;strong&gt;Ms Irene Quay Siew Ching&lt;/strong&gt;...</td>
      <td>{"0": {"entity": "NA", "content": "Ms Irene Qu...</td>
      <td>Ms Irene Quay Siew Ching asked the Minister fo...</td>
      <td>Environment</td>
      <td>[Ms Irene Quay Siew Ching asked the Minister f...</td>
      <td>13</td>
      <td>[{'content': 'Ms Irene Quay Siew Ching asked t...</td>
      <td>[The Senior Minister of State for Health, Dr L...</td>
      <td>2</td>
      <td>ORAL ANSWERS</td>
      <td>2019-05-08</td>
      <td>105</td>
      <td>https://sprs.parl.gov.sg/search/sprs3topic?rep...</td>
      <td>REVIEW OF DRUG TESTING STANDARDS IN SINGAPORE ...</td>
      <td>94</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5d27eca6172d9aa762d48033</td>
      <td>&lt;p class="ql-align-justify"&gt;2 &lt;strong&gt;Mr Lim B...</td>
      <td>{"0": {"entity": "NA", "content": "Mr Lim Biow...</td>
      <td>Mr Lim Biow Chuan asked the Deputy Prime Minis...</td>
      <td>Employment</td>
      <td>[Mr Lim Biow Chuan asked the Deputy Prime Mini...</td>
      <td>13</td>
      <td>[{'content': 'Mr Lim Biow Chuan asked the Depu...</td>
      <td>[Ms Indranee Rajah, The Second Minister for Fi...</td>
      <td>2</td>
      <td>ORAL ANSWERS</td>
      <td>2019-05-08</td>
      <td>105</td>
      <td>https://sprs.parl.gov.sg/search/sprs3topic?rep...</td>
      <td>LIVING IN PRIVATE PROPERTIES BUT WITH NO DECLA...</td>
      <td>94</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="3-text-preprocessing">3. Text Preprocessing</h2>

<p>In <code>read_corpus</code> we iterate through the dataframe above and then use the <code>TaggedDocument</code> function in Gensim to tag a document ID to each document. We can then use this document ID to retrieve additional metadata from our DB after the process is complete.</p>

<pre><code class="language-python">def read_corpus(series_docs, tokens_only=False):
    for line in series_docs.itertuples():
        if tokens_only:
            yield simple_preprocess(line.cleaned_join)
        else:
            # For training data, add tags
            yield gensim.models.doc2vec.TaggedDocument(simple_preprocess(line.cleaned_join), tags=[str(line._1)])

</code></pre>

<p>Create a list of documents with tags:</p>

<pre><code class="language-python">corpus = list(read_corpus(mongo_df,tokens_only=False))
</code></pre>

<p>Display a sample tag:</p>

<pre><code class="language-python">corpus[1].tags
</code></pre>

<pre><code>['5d27eca6172d9aa762d48030']
</code></pre>

<h2 id="4-instantiating-a-doc2vec-gensim-instance">4. Instantiating a Doc2Vec GenSim Instance</h2>

<p>The vector_size, min_count and epochs are some hyperparameters that can be tuned down the road. I used this as it gave a relatively quick training time. In general, larger vectors result in larger training times and it exponentially scales.</p>

<pre><code class="language-python">model = gensim.models.doc2vec.Doc2Vec(vector_size=50, min_count=3, epochs=100, workers=4)
</code></pre>

<h2 id="5-build-a-vocabulary">5. Build a Vocabulary</h2>

<pre><code class="language-python">model.build_vocab(corpus)
</code></pre>

<pre><code class="language-python">%time model.train(corpus, total_examples=model.corpus_count, epochs=model.epochs)
</code></pre>

<pre><code>CPU times: user 20min 22s, sys: 6.98 s, total: 20min 29s
Wall time: 6min 42s
</code></pre>

<h3 id="6-save-model">6. Save Model</h3>

<pre><code class="language-python">model.save('doc2vec')
</code></pre>

<p>We delete training data to reduce in-memory usage after training is complete.</p>

<pre><code class="language-python">model.delete_temporary_training_data()
</code></pre>

<h2 id="7-load-model">7. Load Model</h2>

<p>We can load the model at any time, and this is crucial for deploying it to production.</p>

<pre><code class="language-python">model = gensim.models.doc2vec.Doc2Vec.load('doc2vec')
</code></pre>

<h2 id="8-sample-inference">8. Sample Inference</h2>

<p>In this portion, I will demonstrate how to use the inference to be able to generate a list of similar documents which will then be tied in to our production model.</p>

<p>The <code>infer_vector</code> method is called on the class model that is an instance of our doc2vec saved model which spits out the vectors.</p>

<pre><code class="language-python">inference_1 = model.infer_vector(corpus[291].words)

</code></pre>

<p>Using this, we generate a list of tuples with the id at index 0 and the score at index 1.</p>

<pre><code class="language-python">results = model.docvecs.most_similar([inference_1])
display(results)
</code></pre>

<pre><code>[('5d27eca6172d9aa762d48152', 0.992645263671875),
 ('5d27eca6172d9aa762d49ef0', 0.9119903445243835),
 ('5d27eca6172d9aa762d48b2d', 0.907822847366333),
 ('5d27eca6172d9aa762d48fc3', 0.8947123289108276),
 ('5d27eca6172d9aa762d492f7', 0.8905215859413147),
 ('5d27eca6172d9aa762d49304', 0.8838604688644409),
 ('5d27eca6172d9aa762d48639', 0.8791929483413696),
 ('5d27eca6172d9aa762d49673', 0.8630969524383545),
 ('5d27eca6172d9aa762d49aac', 0.8347380757331848),
 ('5d27eca6172d9aa762d48b5c', 0.8256769180297852)]
</code></pre>

<p>We can see that <code>most_similar</code> returns a list of tuples with the document ID and its respective probability.</p>

<p>Using this knowledge, we can use this to retrieve content from our database.</p>

<pre><code class="language-python">mongo_df[mongo_df['_id'] == ObjectId('5d27eca6172d9aa762d48152')]
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>_id</th>
      <th>article_text</th>
      <th>chunks</th>
      <th>cleaned_join</th>
      <th>dominant_topic</th>
      <th>html_clean</th>
      <th>parliament_num</th>
      <th>parsed_convo</th>
      <th>persons_involved</th>
      <th>session_num</th>
      <th>session_type</th>
      <th>sitting_date</th>
      <th>sitting_num</th>
      <th>src_url</th>
      <th>title</th>
      <th>volume_num</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>291</th>
      <td>5d27eca6172d9aa762d48152</td>
      <td>&lt;p&gt;&lt;strong&gt;The Chairman&lt;/strong&gt;: Head P, Mini...</td>
      <td>{"0": {"entity": "The Chairman", "content": " ...</td>
      <td>The Chairman: Head P, Ministry of Home Affairs...</td>
      <td>Internal Security</td>
      <td>[The Chairman: Head P, Ministry of Home Affair...</td>
      <td>13</td>
      <td>[{'content': 'The Chairman: Head P, Ministry o...</td>
      <td>[Mrs Josephine Teo, Mr Yee Chia Hsing, Ms Jess...</td>
      <td>2</td>
      <td>BUDGET</td>
      <td>2019-03-01</td>
      <td>96</td>
      <td>https://sprs.parl.gov.sg/search/sprs3topic?rep...</td>
      <td>COMMITTEE OF SUPPLY - HEAD P (MINISTRY OF HOME...</td>
      <td>94</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="9-using-it-in-production">9. Using it in Production</h2>

<p>Following that, for our production model, we can create a function that spits out the top 5 similar documents for any document ID that is fed in.</p>

<pre><code class="language-python">def fetch_recommended_document(document_id,mongo_conn,model,n_results=5):
    &quot;&quot;&quot;
    Fetch documents from mongoDB based on inference
    
    &quot;&quot;&quot;
    document = mongo_conn.parliament.articles.find_one({'_id': ObjectId(document_id)})
    inference = model.infer_vector(document['cleaned_join'].split())
    results = model.docvecs.most_similar([inference])
    ids = []
    for item in results[:n_results]:
        ids.append(ObjectId(item[0]))
    
    recommends = []
    for recommend in mongo_conn.parliament.articles.find({&quot;_id&quot; : {&quot;$in&quot; : ids }}):
        recommends.append({
            &quot;_id&quot; : recommend[&quot;_id&quot;],
            &quot;title&quot; : recommend[&quot;title&quot;],
            &quot;sitting_date&quot; : recommend[&quot;sitting_date&quot;],
            &quot;session_type&quot; : recommend[&quot;session_type&quot;]
        })
    return recommends
    
</code></pre>

<p>A sample call:</p>

<pre><code class="language-python">fetch_recommended_document('5d27eca6172d9aa762d48b2d',remote_client,model,6)
</code></pre>

<pre><code>[{'_id': ObjectId('5d27eca6172d9aa762d48152'),
  'title': 'COMMITTEE OF SUPPLY - HEAD P (MINISTRY OF HOME AFFAIRS)',
  'sitting_date': datetime.datetime(2019, 3, 1, 0, 0),
  'session_type': 'BUDGET'},
 {'_id': ObjectId('5d27eca6172d9aa762d48639'),
  'title': 'COMMITTEE OF SUPPLY – HEAD P (MINISTRY OF HOME AFFAIRS)',
  'sitting_date': datetime.datetime(2018, 3, 2, 0, 0),
  'session_type': 'MOTIONS'},
 {'_id': ObjectId('5d27eca6172d9aa762d48b2d'),
  'title': 'COMMITTEE OF SUPPLY − HEAD P (MINISTRY OF HOME AFFAIRS)',
  'sitting_date': datetime.datetime(2017, 3, 3, 0, 0),
  'session_type': 'MOTIONS'},
 {'_id': ObjectId('5d27eca6172d9aa762d48fc3'),
  'title': 'COMMITTEE OF SUPPLY – HEAD P (MINISTRY OF HOME AFFAIRS)',
  'sitting_date': datetime.datetime(2016, 4, 6, 0, 0),
  'session_type': 'MOTIONS'},
 {'_id': ObjectId('5d27eca6172d9aa762d492f7'),
  'title': 'HEAD P – MINISTRY OF HOME AFFAIRS (COMMITTEE OF SUPPLY)',
  'sitting_date': datetime.datetime(2015, 3, 6, 0, 0),
  'session_type': 'MOTIONS'},
 {'_id': ObjectId('5d27eca6172d9aa762d49ef0'),
  'title': 'COMMITTEE OF SUPPLY Âˆ’ HEAD P (MINISTRY OF HOME AFFAIRS)',
  'sitting_date': datetime.datetime(2012, 3, 1, 0, 0),
  'session_type': 'BUDGET'}]
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>While this chapter is pretty short, it covered the concept of vectorization and its applications. As you can see, Doc2Vec is a remarkable tool - especially when pared with recommendation systems such that we can now create semantically aware features that can then be used in classification models.</p>

<p>For example, we can pair this with user preferences to generate a predictive model to access how likely a particular product would appeal to a certain user.</p>

<p>In the next portion of the writeup, I will be touching upon topic modelling that is being used to generate insights on our existing corpus.</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/fastparliament/">fastparliament</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/capstone-recommender/&amp;text=Capstone%20#3%20Content%20Discovery%20System" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/capstone-recommender/&amp;t=Capstone%20#3%20Content%20Discovery%20System" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Capstone%20#3%20Content%20Discovery%20System&amp;body=/post/capstone-recommender/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/capstone-recommender/&amp;title=Capstone%20#3%20Content%20Discovery%20System" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Capstone%20#3%20Content%20Discovery%20System%20/post/capstone-recommender/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/capstone-recommender/&amp;title=Capstone%20#3%20Content%20Discovery%20System" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu778e0e218a9b97c09023dd6c0774c6d0_256939_270x270_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Syamil Maulod</a></h5>
      <h6 class="card-subtitle">Optical Design Engineer, ASML</h6>
      <p class="card-text">From Singapore. Curious about stuff.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:syamil.maulod&#43;ps@gmail.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/bearylogical" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/capstone-summarizer/">Capstone #2 Summarizer</a></li>
      
      <li><a href="/post/capstone-introduction/">Capstone #1 Introduction</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.0630fec5958cb075a5a38f042b3ddde6.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © Syamil 2024 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
