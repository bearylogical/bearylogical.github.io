<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.7.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Syamil Maulod">

  
  
  
    
  
  <meta name="description" content="Generate Insights and Organise Content">

  
  <link rel="alternate" hreflang="en-us" href="/post/capstone-topic-modeling/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu914c65fc3408b2ad669c7753418c6144_392_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu914c65fc3408b2ad669c7753418c6144_392_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/capstone-topic-modeling/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Syamil Maulod">
  <meta property="og:url" content="/post/capstone-topic-modeling/">
  <meta property="og:title" content="Capstone #4 Topic Modeling | Syamil Maulod">
  <meta property="og:description" content="Generate Insights and Organise Content"><meta property="og:image" content="/post/capstone-topic-modeling/featured.png">
  <meta property="twitter:image" content="/post/capstone-topic-modeling/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-07-31T18:12:43&#43;08:00">
    
    <meta property="article:modified_time" content="2019-07-31T18:12:43&#43;08:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/capstone-topic-modeling/"
  },
  "headline": "Capstone #4 Topic Modeling",
  
  "image": [
    "/post/capstone-topic-modeling/featured.png"
  ],
  
  "datePublished": "2019-07-31T18:12:43+08:00",
  "dateModified": "2019-07-31T18:12:43+08:00",
  
  "author": {
    "@type": "Person",
    "name": "Syamil Maulod"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Syamil Maulod",
    "logo": {
      "@type": "ImageObject",
      "url": "img//"
    }
  },
  "description": "Generate Insights and Organise Content"
}
</script>

  

  


  


  





  <title>Capstone #4 Topic Modeling | Syamil Maulod</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Syamil Maulod</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Syamil Maulod</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/tutorial/"><span>Tutorials</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Capstone #4 Topic Modeling</h1>

  
  <p class="page-subtitle">Post #4 on FastParliament</p>
  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Jul 31, 2019
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    13 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/data-science/">data-science</a></span>
  

</div>

  













<div class="btn-links mb-3">
  
  








  









  
  <a class="btn btn-outline-primary my-1 mr-1" href="/project/capstone/">
    Project
  </a>
  











</div>


</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 450px;">
  <div style="position: relative">
    <img src="/post/capstone-topic-modeling/featured_hu3630ab6199e34cb051608c6612a866fe_126862_720x0_resize_lanczos_2.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <blockquote>
<p>This is the forth of a multi part series that details the processes behind 
<a href="https://fparl.bearylogical.net" target="_blank" rel="noopener">FastParliament</a>
. You may view the previous post 
<a href="/post/capstone-recommender/">here</a>
:</p>
</blockquote>
<h2>Table of Contents</h2>
<nav id="TableOfContents">
  <ul>
    <li><a href="#motivation">Motivation</a></li>
    <li><a href="#quick-recap--the-state-of-our-corpus">Quick Recap : The State of Our Corpus</a></li>
    <li><a href="#introducing-latent-dirichlet-allocation-lda">Introducing Latent Dirichlet Allocation (LDA)</a></li>
    <li><a href="#walkthrough---applying-lda">Walkthrough - Applying LDA</a></li>
    <li><a href="#1-import-libraries">1. Import Libraries</a></li>
    <li><a href="#2-create-processing-functions">2. Create Processing Functions</a></li>
    <li><a href="#3-train-lda-model">3. Train LDA Model</a></li>
    <li><a href="#4-coherence-scores-and-tuning">4. Coherence Scores and Tuning</a></li>
    <li><a href="#visualizing-our-coherence-scores-over-number-of-topics">Visualizing our coherence scores over number of topics</a></li>
    <li><a href="#5-visualising-our-lda-model">5. Visualising our LDA Model</a></li>
    <li><a href="#6-assigning-topic-terms-to-topics">6. Assigning Topic Terms to Topics</a></li>
    <li><a href="#7-appending-our-corpus-with-tags">7. Appending our Corpus with Tags!</a></li>
    <li><a href="#8-visualising-our-topic-distributions">8. Visualising our Topic Distributions</a></li>
  </ul>
</nav>
<h2 id="motivation">Motivation</h2>
<p>While topic modeling is not a visible element behind FastParliament, it allows us to derive insights from our corpus that would otherwise not be apparent.</p>
<p>For example, you may be curious to know how discussion topics trend against time, or even ask <em>Is there a special time of the month</em> when parliamentarians discuss on certain key topics?</p>
<p>Now I hope I sparked something in you to best appreciate <em>why</em> this topic modeling thing is interesting!</p>
<h2 id="quick-recap--the-state-of-our-corpus">Quick Recap : The State of Our Corpus</h2>
<p>FastParliament has a document store of around 10,000 documents. Now, that may not be much but imagine if you tasked to &ldquo;find out what parliamentarians talk about&rdquo;.</p>
<p>How might you begin? Well, you could be adventurous and read all 10,000 documents, look out for certain keywords and then slowly group those like minded documents together. Or&hellip; you could be like this guy:</p>















<figure>


  <a data-fancybox="" href="https://qph.fs.quoracdn.net/main-qimg-027c13f7ea7c66680eb164c586133d53-c" data-caption="Laziness is the true mother of all invention">


  <img src="https://qph.fs.quoracdn.net/main-qimg-027c13f7ea7c66680eb164c586133d53-c" alt=""  >
</a>


  
  
  <figcaption>
    Laziness is the true mother of all invention
  </figcaption>


</figure>

<h2 id="introducing-latent-dirichlet-allocation-lda">Introducing Latent Dirichlet Allocation (LDA)</h2>
<p>Taken from 
<a href="https://en.wikipedia.org/wiki/Latent_Dirichlet_allocation" target="_blank" rel="noopener">wikipedia</a>
:</p>
<blockquote>
<p>In natural language processing, latent Dirichlet allocation (LDA) is a generative statistical model that allows sets of observations to be explained by unobserved groups that explain why some parts of the data are similar. For example, if observations are words collected into documents, it posits that each document is a mixture of a small number of topics and that each word&rsquo;s presence is attributable to one of the document&rsquo;s topics.</p>
</blockquote>
<p>Let&rsquo;s unpack that.</p>
<p>First, let&rsquo;s define the word topic. A topic is simply a distribution of words. The topic MONEY will likely contain words related to money such as dollars, cents and taxes. Take note that there is no semantical meaning behind the words. Topics are merely  probabilistic co-occurances of those words. Also, topic naming in itself is a supervised approach. It is supervised in the sense that an actual human has to step in to give meaning to the distribution of words.</p>
<p>Next, we generally assume that each document is a mixture of topics and it follows that the distribution of topics follows a probabilistic model.</p>
<p>Beyond this description, I am not going to delve too much in specifics as the equations that define the probabilistic distribution of topic, words and documents can be somewhat unwieldy.</p>
<h2 id="walkthrough---applying-lda">Walkthrough - Applying LDA</h2>
<p>In this section I will be showing how LDA was applied for our corpus. This follows very closely to the tutorials suppled by Gensim.</p>
<p>Additionally, we also used pyLDAVis to visualise the topic distribution and also show the histogram of words for a particular topic.</p>
<h2 id="1-import-libraries">1. Import Libraries</h2>
<pre><code class="language-python">import numpy as np
import pandas as pd
from datetime import date 

import matplotlib.pyplot as plt
import seaborn as sns

import pyLDAvis.gensim
import pyLDAvis
import pymongo 

from tqdm import tqdm

import gensim
from gensim.utils import simple_preprocess
from nltk.corpus import stopwords

from bson.json_util import dumps
</code></pre>
<h2 id="2-create-processing-functions">2. Create Processing Functions</h2>
<pre><code class="language-python"># Create stopwords
stop_words = stopwords.words('english')

# Convert Sentences to words
def sent_to_words(sentences):
    for sentence in sentences:
        yield(gensim.utils.simple_preprocess(str(sentence), deacc=True))  # deacc=True removes punctuations

# Remove Stopwords
def remove_stopwords(texts):
    return [[word for word in simple_preprocess(str(doc)) if word not in stop_words] for doc in texts]

# Generate Bigrams from text
def bigrams(words, bi_min=15, tri_min=10):
    bigram = gensim.models.Phrases(words, min_count = bi_min)
    bigram_mod = gensim.models.phrases.Phraser(bigram)
    return bigram_mod

# Combine preprocessing techniques and incorporate bigrams to generate corpus, vocabulary(bigram) and dictionary(id2word).    
def get_corpus(df):
    words = list(sent_to_words(df.cleaned_join))
    words = remove_stopwords(words)
    bigram_mod = bigrams(words)
    bigram = [bigram_mod[review] for review in words]
    id2word = gensim.corpora.Dictionary(bigram)
    id2word.filter_extremes(no_below=10, no_above=0.35)
    id2word.compactify()
    corpus = [id2word.doc2bow(text) for text in bigram]
    return corpus, id2word, bigram

train_corpus, train_id2word, bigram_train = get_corpus(mongo_df)
</code></pre>
<h2 id="3-train-lda-model">3. Train LDA Model</h2>
<p>We use the <code>ldamulticore</code> function to be able to utilise more cores to generate our model. We then save the model so we can reuse it for future.</p>
<pre><code class="language-python">import warnings
import logging # This allows for seeing if the model converges. A log file is created.
logging.basicConfig(filename='lda_model.log', format='%(asctime)s : %(levelname)s : %(message)s', level=logging.INFO)

with warnings.catch_warnings():
    warnings.simplefilter('ignore')
    lda_train = gensim.models.ldamulticore.LdaMulticore(
                           corpus=train_corpus,
                           num_topics=10,
                           id2word=train_id2word,
                           chunksize=100,
                           workers=5, # Num. Processing Cores - 1
                           passes=50,
                           eval_every = 1,
                           per_word_topics=True)
lda_train.save('lda_train.model')
</code></pre>
<h2 id="4-coherence-scores-and-tuning">4. Coherence Scores and Tuning</h2>
<p>While there can be a multitude of ways to assess the coherence of a model, $$C_v$$ is used in FastParliament which is a combination of two other coherence measure. More details can be found 
<a href="http://svn.aksw.org/papers/2015/WSDM_Topic_Evaluation/public.pdf" target="_blank" rel="noopener">here</a>
.</p>
<p>A function <code>compute_coherence_values</code>, which is from this 
<a href="https://datascienceplus.com/evaluation-of-topic-modeling-topic-coherence/" target="_blank" rel="noopener">great</a>
 resource by datascience+ is used for the subsequent evaluation of our coherence scores. It is paired with the <code>CoherenceModel</code> in Gensim to obtain the scores.</p>
<pre><code class="language-python">from gensim.models import CoherenceModel

def compute_coherence_values(dictionary, corpus, texts, limit, start=2, step=3):
    &quot;&quot;&quot;
    Compute c_v coherence for various number of topics

    Parameters:
    ----------
    dictionary : Gensim dictionary
    corpus : Gensim corpus
    texts : List of input texts
    limit : Max num of topics

    Returns:
    -------
    model_list : List of LDA topic models
    coherence_values : Coherence values corresponding to the LDA model with respective number of topics
    &quot;&quot;&quot;
    coherence_values = []
    model_list = []
    for num_topics in range(start, limit, step):
        model = gensim.models.ldamulticore.LdaMulticore(
                           corpus=corpus,
                           num_topics=num_topics,
                           id2word=train_id2word,
                           chunksize=1000,
                           workers=5, # Num. Processing Cores - 1
                           passes=50,
                           eval_every = 1,
                           per_word_topics=True)
        model_list.append(model)
        coherencemodel = CoherenceModel(model=model, texts=texts, dictionary=dictionary, coherence='c_v')
        coherence_values.append(coherencemodel.get_coherence())

    return model_list, coherence_values

</code></pre>
<p>As you can see, this function takes in the scores, at spits out a list of scores with respect to the number of topics defined.</p>
<p>However, it should be noted that each time the model instance is called to generate the LDA model, the values are <strong>stochastically determined</strong>. As such, it may not be a highly accurate method of accessing coherence, but it largely serves our purpose.</p>
<pre><code class="language-python"># run
model_list, coherence_values = compute_coherence_values(dictionary=train_id2word, 
                                                        corpus=train_corpus, texts=bigram_train, start=5, limit=40, step=2)
</code></pre>
<h2 id="visualizing-our-coherence-scores-over-number-of-topics">Visualizing our coherence scores over number of topics</h2>
<pre><code class="language-python">import matplotlib.pyplot as plt

%matplotlib inline

# Show graph
limit=40; start=5; step=2;
x = range(start, limit, step)
plt.plot(x, coherence_values)
plt.xlabel(&quot;Num Topics&quot;)
plt.ylabel(&quot;Coherence score&quot;)
plt.legend((&quot;coherence_values&quot;), loc='best')
plt.show()


</code></pre>
<p><img src="coherence.png" alt="png"></p>
<h2 id="5-visualising-our-lda-model">5. Visualising our LDA Model</h2>
<p>We then use pyLDAVis, which is a great port of the LDAvis library from R, to visualize our topics and the words distribution within the topic.</p>
<pre><code class="language-python">## Visualise our model
pyLDAvis.enable_notebook(sort=True)
vis = pyLDAvis.gensim.prepare(lda_train, train_corpus, train_id2word)
pyLDAvis.display(vis)
</code></pre>
<p>Due to iframe limitations, I&rsquo;m not able to squeeze it in this post, but you may view the visualisation 
<a href="/post/capstone-topic-modeling/lda.html">here</a>
. However, here is a screenshot:</p>
<p><img src="ldavis.png" alt="png"></p>
<h2 id="6-assigning-topic-terms-to-topics">6. Assigning Topic Terms to Topics</h2>
<p>After that is all said and done, we move on to assigning the terms to each topic.</p>
<p>In this iteration of modeling, we print out the top 20 words associated to a topic.</p>
<pre><code class="language-python">for idx, topic in lda_train.print_topics(-1, num_words=20):
    print(&quot;{}. Topic: {}  \n\t- Key Words: {}&quot;.format(idx+1, idx, (&quot;,&quot;.join(re.sub(r'\d.\d+\*','',topic).replace('&quot;','').split('+')))))
</code></pre>
<pre><code>1. Topic: 0  
    - Key Words: water , nea , public , residents , town_councils , food , ensure , town_council , ministry , areas , year , use , pub , sir , health , management , buildings , resources , measures , would
2. Topic: 1  
    - Key Words: new , companies , government , industry , help , services , support , sector , businesses , smes , business , technology , continue , develop , local , example , growth , opportunities , development , need
3. Topic: 2  
    - Key Words: saf , mas , defence , countries , asean , international , us , security , training , year , financial , foreign , region , ns , mindef , banks , china , financial_institutions , continue , investment
4. Topic: 3  
    - Key Words: students , education , schools , school , community , moe , children , support , programmes , parents , teachers , sports , learning , programme , work , arts , help , year , training , provide
5. Topic: 4  
    - Key Words: hdb , lta , new , flats , would , time , residents , public_transport , flat , year , one , housing , road , operators , commuters , transport , system , development , first , sir
6. Topic: 5  
    - Key Words: police , public , officers , cases , security , safety , home_affairs , number , ministry , community , measures , order , would , crime , act , ensure , take , offence , work , home_team
7. Topic: 6  
    - Key Words: care , children , support , help , patients , health , family , need , families , singaporeans , healthcare , community , medical , services , parents , elderly , scheme , seniors , provide , child
8. Topic: 7  
    - Key Words: people , government , one , would , singaporeans , us , think , must , need , even , sir , time , said , want , like , first , know , make , good , society
9. Topic: 8  
    - Key Words: workers , government , help , companies , work , singaporeans , jobs , budget , employers , would , need , year , one , support , scheme , time , sir , economy , employment , new
10. Topic: 9  
    - Key Words: bill , act , would , law , case , court , legal , amendments , public , section , cases , sir , make , first , members , time , made , person , one , ensure
</code></pre>
<p>Accordingly, we can label the 10 topics as follows:</p>
<ol>
<li>Topic: 0 - Environment
<ul>
<li>Key Words: water , nea , public , residents , town_councils , food , ensure , town_council , ministry , areas</li>
</ul>
</li>
<li>Topic: 1 - Business
<ul>
<li>Key Words: new , companies , government , industry , help , services , support , sector , businesses , smes</li>
</ul>
</li>
<li>Topic: 2 - External Security
<ul>
<li>Key Words: saf , mas , defence , countries , asean , international , us , security , training , year</li>
</ul>
</li>
<li>Topic: 3 - Education
<ul>
<li>Key Words: students , education , schools , school , community , moe , children , support , programmes , parents</li>
</ul>
</li>
<li>Topic: 4 - Living
<ul>
<li>Key Words: hdb , lta , new , flats , would , time , residents , public_transport , flat , year</li>
</ul>
</li>
<li>Topic: 5 - Internal Security
<ul>
<li>Key Words: police , public , officers , cases , security , safety , home_affairs , number , ministry , community</li>
</ul>
</li>
<li>Topic: 6 - Healthcare
<ul>
<li>Key Words: care , children , support , help , patients , health , family , need , families , singaporeans</li>
</ul>
</li>
<li>Topic: 7 - Society
<ul>
<li>Key Words: people , government , one , would , singaporeans , us , think , must , need , even</li>
</ul>
</li>
<li>Topic: 8 - Employment
<ul>
<li>Key Words: workers , government , help , companies , work , singaporeans , jobs , budget , employers , would</li>
</ul>
</li>
<li>Topic: 9 - Law
<ul>
<li>Key Words: bill , act , would , law , case , court , legal , amendments , public , section</li>
</ul>
</li>
</ol>
<h2 id="7-appending-our-corpus-with-tags">7. Appending our Corpus with Tags!</h2>
<p>Given that we now know what topic numbers refer to what topics, we will then assign a topic to each document. The dominant topic (highest probability) will be assigned.</p>
<p>For a particular document :</p>
<pre><code class="language-python">## Access document at index 1 and obtain list of tuples where each topic is the index of the topic and the score.
row = model[train_corpus][1]
## Sort probabilities in descending order
row = sorted(row[0], key=lambda x: x[1], reverse=True)

</code></pre>
<pre><code>[(7, 0.43655953),
 (2, 0.17807838),
 (0, 0.13052306),
 (9, 0.09896996),
 (5, 0.058110144),
 (1, 0.054801296),
 (4, 0.042660255)]
</code></pre>
<p>We then create a function to show us the score of each dominant topic in a document</p>
<pre><code class="language-python">def format_topics_sentences(ldamodel=model, corpus=train_corpus,texts=bigram_train):
    # https://www.machinelearningplus.com/nlp/topic-modeling-gensim-python/
    # Init output
    sent_topics_df = pd.DataFrame()

    # Get top 3 topic in each document
    for i, row in enumerate(ldamodel[corpus]):
        row = sorted(row[0], key=lambda x: x[1], reverse=True)
        # Get the Dominant topic, Perc Contribution and Keywords for each document
        for j, (topic_num, prop_topic) in enumerate(row):
            if j == 0:  # =&gt; dominant topic
                wp = ldamodel.show_topic(topic_num)
                topic_keywords = &quot;, &quot;.join([word for word, prop in wp])
                sent_topics_df = sent_topics_df.append(pd.Series([int(topic_num), round(prop_topic,4), topic_keywords]), ignore_index=True)
            else:
                break
    sent_topics_df.columns = ['Dominant_Topic', 'Perc_Contribution', 'Topic_Keywords']

    # Add original text to the end of the output
    contents = pd.Series(texts)
    sent_topics_df = pd.concat([sent_topics_df, contents], axis=1)
    return(sent_topics_df)

df_topic_sents_keywords = format_topics_sentences(ldamodel=model, corpus=train_corpus, texts=bigram_train)

# Format
df_dominant_topic = df_topic_sents_keywords.reset_index()
df_dominant_topic.columns = ['Document_No', 'Dominant_Topic', 'Topic_Perc_Contrib', 'Keywords', 'Text']

# Show
df_dominant_topic.head(10)
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre>
<p></style></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Document_No</th>
      <th>Dominant_Topic</th>
      <th>Topic_Perc_Contrib</th>
      <th>Keywords</th>
      <th>Text</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>7.0</td>
      <td>0.4911</td>
      <td>people, government, one, would, singaporeans, ...</td>
      <td>[proc_text, debate_resumed, proc_text, br_mr, ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>7.0</td>
      <td>0.4366</td>
      <td>people, government, one, would, singaporeans, ...</td>
      <td>[mr_vikram, nair_asked, minister, foreign_affa...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>5.0</td>
      <td>0.3280</td>
      <td>police, public, officers, cases, security, saf...</td>
      <td>[assoc_prof, walter_theseira, asked_minister, ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0.0</td>
      <td>0.2807</td>
      <td>water, nea, public, residents, town_councils, ...</td>
      <td>[ms_irene, quay_siew, ching, asked_minister, h...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>7.0</td>
      <td>0.3995</td>
      <td>people, government, one, would, singaporeans, ...</td>
      <td>[mr_lim, biow_chuan, asked_deputy, prime_minis...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>6.0</td>
      <td>0.4204</td>
      <td>care, children, support, help, patients, healt...</td>
      <td>[mr_louis, ng_kok, kwang_asked, minister, heal...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>7.0</td>
      <td>0.3054</td>
      <td>people, government, one, would, singaporeans, ...</td>
      <td>[mr_png, eng_huat, asked_deputy, prime_ministe...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>8.0</td>
      <td>0.2996</td>
      <td>workers, government, help, companies, work, si...</td>
      <td>[mr_louis, ng_kok, kwang_asked, minister_manpo...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8</td>
      <td>3.0</td>
      <td>0.5370</td>
      <td>students, education, schools, school, communit...</td>
      <td>[ms_irene, quay_siew, ching, asked_minister, e...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9</td>
      <td>7.0</td>
      <td>0.4994</td>
      <td>people, government, one, would, singaporeans, ...</td>
      <td>[proc_text, resumption_debate, question, may, ...</td>
    </tr>
  </tbody>
</table>
</div>
<p>By focusing only on adding the dominant topic to our dataframe, we then create a function called <code>retrieve_dominant_topic</code>.</p>
<pre><code class="language-python">def retrieve_dominant_topic(doc, model=model ,ref_dict=lda_dict, threshold=0.1):
    doc_bow_sample = ref_dict.doc2bow(doc.split()) #input has to be a list of strings
    highest_prob = sorted(model.get_document_topics(doc_bow_sample),key=lambda x : x[1], reverse=True)[0][1]
    if highest_prob &gt; threshold:
        topic_num = sorted(model.get_document_topics(doc_bow_sample),key=lambda x : x[1], reverse=True)[0][0]
    else:
        topic_num = 11 # no topic identidied
    
    return topic_num 
</code></pre>
<p>We then use pandas <code>.map()</code> function to map each topic to each row of our document corpus.</p>
<pre><code class="language-python">%time mongo_df['dominant_topic'] = mongo_df.cleaned_join.map(lambda x : retrieve_dominant_topic(x))
</code></pre>
<p>By defining the <code>dominant_topic_mappings</code> dictionary, we then map the numbers to the actual strings that define the topic id.</p>
<pre><code class="language-python">dominant_topic_mappings = {
    0 : 'Environment',
    1 : 'Business',
    2 : 'External Security',
    3 : 'Education',
    4 : 'Living',
    5 : 'Internal Security',
    6 : 'Healthcare',
    7 : 'Society',
    8 : 'Employment',
    9 : 'Law',
    11 : 'Unidentified'
}
</code></pre>
<pre><code class="language-python">mongo_df['dominant_topic'] = mongo_df['dominant_topic'].map(dominant_topic_mappings)
</code></pre>
<h2 id="8-visualising-our-topic-distributions">8. Visualising our Topic Distributions</h2>
<p>With each document having the <code>dominant_topic</code> label, we then moved to visualise it.</p>
<pre><code class="language-python">
sns.catplot(x='dominant_topic',kind=&quot;count&quot;,data = mongo_df,height=5, aspect=3 )

</code></pre>
<p><img src="topic_distrib.png" alt="png"></p>
<p>Now that we have gotten our topics, we then try to answer our initial question :</p>
<p><em>How have topics changed over time?</em></p>
<p>In the example below, I chose <code>Education</code> as a topic. In this visualisation, we are looking at how the topic trends vary across the months of the year. Accordingly, the intensity of the line hue reflects more recent years</p>
<pre><code class="language-python">topic = &quot;Education&quot;

plt.figure(figsize=(20,10))
ax = sns.relplot(x=&quot;month&quot;, y=&quot;topic_count&quot;, hue=&quot;year&quot;, kind = &quot;line&quot;, data=topic_groupings_count[topic_groupings_count['dominant_topic'] == topic],aspect=2)
plt.title(topic)
</code></pre>
<p><img src="education.png" alt="png"></p>
<pre><code class="language-python">plt.figure(figsize=(20,10))
ax = sns.lineplot(x=&quot;year&quot;, y=&quot;topic_count&quot;, hue=&quot;dominant_topic&quot;,  data=topic_groupings_count)
plt.setp(ax.collections, alpha=0)
</code></pre>
<p><img src="topic_plot.png" alt="png"></p>
<p>Thanks for following through with this entire post! I hope you came away with more understanding on the capabilities of LDA as well as various visualization methods.</p>
<p>Till next time!</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/fastparliament/">fastparliament</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/capstone-topic-modeling/&amp;text=Capstone%20#4%20Topic%20Modeling" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/capstone-topic-modeling/&amp;t=Capstone%20#4%20Topic%20Modeling" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Capstone%20#4%20Topic%20Modeling&amp;body=/post/capstone-topic-modeling/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/capstone-topic-modeling/&amp;title=Capstone%20#4%20Topic%20Modeling" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Capstone%20#4%20Topic%20Modeling%20/post/capstone-topic-modeling/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/capstone-topic-modeling/&amp;title=Capstone%20#4%20Topic%20Modeling" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu778e0e218a9b97c09023dd6c0774c6d0_256939_270x270_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Syamil Maulod</a></h5>
      <h6 class="card-subtitle">Optical Design Engineer, ASML</h6>
      <p class="card-text">From Singapore. Curious about stuff.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:syamil.maulod&#43;ps@gmail.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/bearylogical" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/capstone-recommender/">Capstone #3 Content Discovery System</a></li>
      
      <li><a href="/post/capstone-summarizer/">Capstone #2 Summarizer</a></li>
      
      <li><a href="/post/capstone-introduction/">Capstone #1 Introduction</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.0630fec5958cb075a5a38f042b3ddde6.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © Syamil 2024 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
